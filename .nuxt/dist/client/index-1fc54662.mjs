import{_ as q}from"./nav-bar-8aedbc5e.mjs";import{_ as D,d as N,u as O,i as P,r,a as F,o as I,h as H,b as m,c as v,e as K,f as t,t as i,F as R,q as V,g as B,m as w,s as L}from"./entry-f1ebb262.mjs";const M=N({__name:"index",setup(S,{expose:g}){g();const l=O(),e=P(),d=r();e.$subscribe(s=>{d.value=e.cart.length}),F({title:"cart",link:[{rel:"icon",href:"../assets/icons/undraw_breakfast_psiw.svg"}]});const c=r(),u=r(!1);let a;I(async()=>{const s={ids:e.cart},o=await(await fetch("http://localhost:8000/get-specific-ids",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();o==[]?u.value=!0:(c.value=o,_()),d.value=e.cart.length;try{a=(await(await fetch(`http://localhost:8000/get-phone/${l.getID}`)).json()).phone}catch{console.log("could get number")}});const p=async(s,n)=>{let o=c.value.find(j=>j._id===s);const f=await(await fetch(`http://localhost:8000/get-price/${s}`)).json();n===!0?(o.quantity++,o.price=o.price+f.price):n===!1&&o.quantity>1&&(o.quantity--,o.price=o.price-f.price),_()},y=r(),b=r(),_=()=>{const s=c.value.reduce((n,o)=>n+o.price,0);b.value=s,y.value=s+300},T=()=>{e.$subscribe(async()=>{const s={id:l.getID,newCart:e.cart};await(await fetch("http://localhost:8000/update-cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()})},x=s=>{const n=c.value.find(h=>h._id==s);let o=c.value.indexOf(n);c.value.splice(o,1),e.removeFromCart(s),_()},C=H(),k={logins:l,cart:e,cartNumber:d,cartItemsDisplay:c,emptyCart:u,phone:a,changeQuantity:p,total:y,checkout:b,balanceToPay:_,stateChange:T,removeFromCart:x,router:C,pay:async()=>{const s=c.value.map(n=>({item:n._id,price:n.price,quantity:n.quantity}));e.updateOrder(s),a==null?C.push("/login"):await(await fetch("https://tinypesa.com/api/v1/express/initialize",{method:"POST",headers:{Apikey:"Me3s8tLM8vW","Content-Type":"application/x-www-form-urlencoded"},body:`amount=${y.value}&msisdn=${a}&account_no=200`})).json()}};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}}),Q={class:"top-cart-bar"},$=w(" cart ("),J=w(") "),z={key:0,class:"cart"},A={class:"items"},E=["src"],W={class:"details"},G={class:"quantity"},U=["onClick"],X=["onClick"],Y=["onClick"],Z=t("img",{src:L,alt:"",srcset:""},null,-1),tt=[Z],et={class:"checkout"},st={class:"sub"},ot=t("p",null,"sub total",-1),at=t("div",{class:"delivery-fee"},[t("p",null,"delivery"),t("h4",null,"KSH 300")],-1),nt={class:"total"},ct=t("p",null,"total",-1);function it(S,g,l,e,d,c){const u=q;return m(),v("main",null,[K(u),t("div",Q,[t("h2",null,[$,t("strong",null,i(e.cartNumber),1),J]),t("p",null,"sub total KSH "+i(e.checkout),1)]),e.cartItemsDisplay?(m(),v("div",z,[t("div",A,[(m(!0),v(R,null,V(e.cartItemsDisplay,a=>(m(),v("div",{class:"single-item",key:a._id},[t("img",{src:a.image,alt:"",srcset:""},null,8,E),t("div",W,[t("h4",null,"KSH "+i(a.price),1),t("p",null,i(a.name),1),t("div",G,[t("p",{class:"add",onClick:p=>e.changeQuantity(a._id,!0)},"+",8,U),t("h5",null,i(a.quantity),1),t("p",{class:"minus",onClick:p=>e.changeQuantity(a._id,!1)},"-",8,X)])]),t("div",{class:"delete",onClick:p=>e.removeFromCart(a._id)},tt,8,Y)]))),128))]),t("div",et,[t("div",st,[ot,t("h4",null,"Ksh "+i(e.checkout),1)]),at,t("div",nt,[ct,t("h4",null,i(e.total),1)]),t("button",{onClick:e.pay},"proceed to pay")])])):B("",!0)])}var ut=D(M,[["render",it]]);export{ut as default};
